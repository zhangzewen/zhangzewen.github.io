<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="zh-cn" lang="zh-cn" >

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.149.0">

  <title>What a Life!</title>

  <meta name="description" content="Software Engineer" />

  
  <meta itemprop="name" content="What a Life!">
  <meta itemprop="description" content="Software Engineer">
  <meta itemprop="datePublished" content="2025-08-29T02:43:31+08:00">
  <meta itemprop="dateModified" content="2028-02-17T08:13:34+08:00">
  <meta itemprop="image" content="https://www.zhangzewen.net/images/profile.png">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.zhangzewen.net/images/profile.png">
  <meta name="twitter:title" content="What a Life!">
  <meta name="twitter:description" content="Software Engineer">


<meta property="og:url" content="https://www.zhangzewen.net/">
  <meta property="og:site_name" content="What a Life!">
  <meta property="og:title" content="What a Life!">
  <meta property="og:description" content="Software Engineer">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">
    <meta property="og:image" content="https://www.zhangzewen.net/images/profile.png">



<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type":"Person",
      "@id": "https://www.zhangzewen.net/#author",
      "name": "Zhang Zewen",
      "image": {
        "@type":"ImageObject",
        
        "url": "https://www.zhangzewen.net/images/android-chrome-512x512.png"
        
      },
      "description": "Software Engineer"
    },
    {
      "@type": "WebSite",
      "@id": "https://www.zhangzewen.net/#website",
      "url": "https://www.zhangzewen.net/",
      "name": "What a Life!",
      "description": "Software Engineer",
      "publisher": {
        "@id": "https://www.zhangzewen.net/#author"
      },
      "inLanguage": "zh-cn"
    },
    {
      "@type": "ImageObject",
      "url": "https://www.zhangzewen.net/images/profile.png",
      "caption": "What a Life!"
    },
    {
      "@type": "WebPage",
      "@id": "https://www.zhangzewen.net/#webpage",
      "url": "https://www.zhangzewen.net/",
      "name": "What a Life!",
      "isPartOf": {
        "@id": "https://www.zhangzewen.net/#website"
      },
      "about": {
         "@id": "https://www.zhangzewen.net/#author"
      },
      "datePublished": "2025-08-29T02:43:31+08:00",
      "dateModified": "2028-02-17T08:13:34+08:00",
      "description": "Software Engineer",
      "inLanguage": "zh-cn",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": [
            "https://www.zhangzewen.net/"
          ]
        }
      ]
    }
  ]
}
</script>



  <link type="text/css" rel="stylesheet" href="/css/print.css" media="print">

  <link type="text/css" rel="stylesheet" href="/css/poole.css">

  <link type="text/css" rel="stylesheet" href="/css/hyde.css">

  


  

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  
  <link href="https://www.zhangzewen.net/index.xml" rel="alternate" type="application/rss+xml" title="What a Life!" />
  </head>

<body>
  <aside class="toc">
  
  
  
</aside>

  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="https://www.zhangzewen.net/">
            <img src="/images/android-chrome-512x512.png" class="img-circle img-headshot center" alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>What a Life!</h1>

      
      <p class="lead">Software Engineer</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://www.zhangzewen.net/">Home</a>
        </li>
        <li>
          <a href="/tags/">Tags</a>
        </li><li>
          <a href="/archive/">Archives</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
    </section>
  </div>
</aside>


  <main class="content container">
    <div class="posts">
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel/">flannel 源码分析</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-07-21T23:43:31&#43;0800">Jul 21, 2025</time> &middot; 8 min read
        </div>

        <div>
          <p>flannel 的配置一般如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;Network&#34;</span>:<span style="color:#f1fa8c">&#34;10.0.0.0/16&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;SubnetLen&#34;</span>:<span style="color:#bd93f9">24</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;SubnetMin&#34;</span>:<span style="color:#f1fa8c">&#34;10.0.1.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;SubnetMax&#34;</span>:<span style="color:#f1fa8c">&#34;10.0.20.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;Backend&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;Type&#34;</span>:<span style="color:#f1fa8c">&#34;vxlan&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Network：用于指定Flannel地址池。</li>
<li>SubnetLen：用于指定分配给单个宿主机的docker0的ip段的子网掩码的长度。</li>
<li>SubnetMin：用于指定最小能够分配的ip段。</li>
<li>SudbnetMax：用于指定最大能够分配的ip段，在上面的示例中，表示每个宿主机可以分配一个24位掩码长度的子网，可以分配的子网从10.0.1.0/24到10.0.20.0/24，也就意味着在这个网段中，最多只能有20台宿主机。</li>
<li>Backend：，用于在跨主机通信时指定数据包以什么方式转发，如vxlan/host-gw/udp等。</li>
</ul>
<p>flannel 中比较重要的概念</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel-hostgw/">flannel 源码分析之 host-gw 模式</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-07-21T23:43:31&#43;0800">Jul 21, 2025</time> &middot; 4 min read
        </div>

        <div>
          <p>flannel 的 host-gw 网络模式不涉及数据包的封包和解包，就是在宿主机上配置路由规则，把其它宿主机ip当成其上所有pod的下一跳。</p>
<h2 id="注册和创建-host-gw-network-实例">注册和创建 host-gw Network 实例</h2>
<p>结构体 HostgwBackend 实现了接口 Backend 。</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel-hostgw/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel-vxlan/">flannel 源码分析之 vxlan 模式</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-07-21T23:43:31&#43;0800">Jul 21, 2025</time> &middot; 8 min read
        </div>

        <div>
          <h2 id="注册和创建-vxlan-network-实例">注册和创建 vxlan Network 实例</h2>
<p>结构体 VXLANBackend 实现了接口 Backend 和 Network。
vxlan 注册到 flannel 的流程如下:</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/cni/flannel-vxlan/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/linux/cs144_simple_summary/">Stanford 公开课 CS144 2025版 通关指南</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-07-15T09:43:31&#43;0800">Jul 15, 2025</time> &middot; 6 min read
        </div>

        <div>
          <h2 id="环境准备">环境准备</h2>
<p>我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/linux/cs144_simple_summary/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/csi-volume-plugin/">kubernetes 源码分析之 CSI Volume Plugin</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-06-27T09:43:31&#43;0800">Jun 27, 2025</time> &middot; 8 min read
        </div>

        <div>
          <blockquote>
<p>本篇文章基于 Kubernetes v1.25.1</p></blockquote>
<p>在 kubernetes 中，第三方 CSI Plugin 注册到 kubelet 是通过 CSI Volume Plugin 来完成的。</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/csi-volume-plugin/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/life/shao_tai/">少太连穿</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-06-21T14:54:32&#43;0800">Jun 21, 2025</time> &middot; 1 min read
        </div>

        <div>
          <p>自四川回来之后，整个四、五月份都没有进山，一直在路跑。进六月份后实在是心痒难受，南太行刚解封人多不想去，能一日往返的也就旁边的嵩山了，这里有个很成熟的路线：少太连穿。</p>
<p>少太穿越说的是少室山和太室山连穿，以少室山摩崖石刻为起点，途径三皇寨、少林寺，经永泰寺进入太室山，一路攀爬到峻极峰，以卢崖瀑布为终点的经典穿越路线。整个路线 32KM+，爬升 2000M+，难度适中。如果要加点难度的话，可以加上达摩洞和嵩顶草甸。</p>
<p>风景主要集中在少室山，且景区路线，三皇庙到书册崖是少室山的精华所在，是随便找个地方可以坐上一天的那种。而且可以从少林寺坐缆车到三皇寨，所以游人很多，且小卖部分布很均匀。</p>
<p>难度主要集中在太室山，从永泰寺一直到峻极峰都是山路，永泰寺到山脊线起点石楼这段的爬升有足足有 760m 之多。 石楼前的一段以及之后到峻极峰的山脊线有几处有些危险，都是一到两个身位落差的直上直下攀爬。峻极峰之前，没有任何补给点，过了峻极峰就是成熟的景区路线了。今年雨水少，所以卢崖瀑布并不壮观。要不是单纯的刷路线记录，到了峻极峰是可以掐表，然后慢慢悠悠从景区下撤的。</p>
<p>至于少林寺，感觉少林寺商业化太严重了，景区里一瓶尖叫卖15元你敢信？！过年的时候带父母来玩了一趟，逛完塔林他们就嚷嚷着要回去。可能是不信佛的缘故，庙宇我觉得都是大同小异。而且都跑了好几趟了，想打卡少林寺都不能够，门前的场地人是真的多。</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/life/shao_tai/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/volume_plugins_manager/">kubernetes 源码分析之 kubelet volume plugins manager</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-06-18T09:43:31&#43;0800">Jun 18, 2025</time> &middot; 3 min read
        </div>

        <div>
          <blockquote>
<p>本篇文章基于 Kubernetes v1.25.1</p></blockquote>
<p>在 kubernetes 中存储以插件的形似存在，kubernetes 提供了接口 <a href="https://github.com/kubernetes/kubernetes/blob/e4d4e1ab7cf1bf15273ef97303551b279f0920a9/pkg/volume/volume.go#L30">Volume</a> 极其扩展接口来表示存储卷，使用 <a href="https://github.com/kubernetes/kubernetes/blob/e4d4e1ab7cf1bf15273ef97303551b279f0920a9/pkg/volume/plugins.go#L134">VolumePlugin</a> 接口来表示一个存储卷插件。像常用的 <code>empty/hostpath/configmap/secert/csi</code> 等都是以插件形式存在的存储卷（这里的 csi 是让 kubernetes 可以使用第三方提供的存储功能），kubelet 使用 volume plugins manager 来管理它们。</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/volume_plugins_manager/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/database/cmu15445/summary/">cmu15445 实现踩坑不完全指北</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-06-14T22:36:42&#43;0800">Jun 14, 2025</time> &middot; 0 min read
        </div>

        <div>
          
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/database/cmu15445/summary/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/pod-create-and-start/">kubernetes 源码分析之 kubelet pod 的创建和启动</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-05-25T16:33:16&#43;0800">May 25, 2025</time> &middot; 14 min read
        </div>

        <div>
          <p>接口 SyncHandler 定义了一系列管理 Pod 的方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> SyncHandler <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 新增</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodAdditions</span>(pods []<span style="color:#ff79c6">*</span>v1.Pod)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 更新</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodUpdates</span>(pods []<span style="color:#ff79c6">*</span>v1.Pod)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 删除</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodRemoves</span>(pods []<span style="color:#ff79c6">*</span>v1.Pod)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 协调</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodReconcile</span>(pods []<span style="color:#ff79c6">*</span>v1.Pod)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 同步</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodSyncs</span>(pods []<span style="color:#ff79c6">*</span>v1.Pod)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 清理</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">HandlePodCleanups</span>() <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>结构体 Kubelet 实现了该方法。<code>Kubelet.HandlePodAdditions</code> 的流程如下：</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/pod-create-and-start/">Read More</a>
        </div>
      </article>
      <article class="post">
        <h1 class="post-title">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/syncloop/">kubernetes 源码分析之 kubelet syncLoop</a>
        </h1>

        <div class="post-date">
          <time datetime="2025-05-25T16:31:39&#43;0800">May 25, 2025</time> &middot; 5 min read
        </div>

        <div>
          <blockquote>
<p>本篇文章基于 Kubernetes v1.25.1</p></blockquote>
<p>kubelet 是由多个生产者和多个消费者组成的后台服务，其内部实现是一个控制循环，由事件驱动着控制循环的运行，如下图所示：</p>
<p><img src="/images/kubernetes/kubelet/syncLoop.png" alt="syncLoop"></p>
<p>这个图片是展示的组件和本篇分析所使用的kubernetes 版本已经有所不同，但是其设计理念没有变法，依旧是 syncLoop 驱动着整个控制循环的运行。</p>
        </div>

        <div class="read-more-link">
          <a href="https://www.zhangzewen.net/posts/kubernetes/kubelet/syncloop/">Read More</a>
        </div>
      </article>
  </div>

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/" aria-label="Page 1" class="page-link" role="button">1</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 2" class="page-link" role="button">2</a>
      </li>
      <li class="page-item">
        <a href="/page/3/" aria-label="Page 3" class="page-link" role="button">3</a>
      </li>
      <li class="page-item">
        <a href="/page/4/" aria-label="Page 4" class="page-link" role="button">4</a>
      </li>
      <li class="page-item">
        <a href="/page/5/" aria-label="Page 5" class="page-link" role="button">5</a>
      </li>
      <li class="page-item">
        <a href="/page/3/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/7/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
  </main>

  <footer>
  <div>
    <p>
      &copy; Zhang Zewen 2025

      &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

      
    </p>
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
    integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin="anonymous"></script>


  <script src="/js/jquery.min.js"></script>
  <script src="/js/soho.js"></script>

  

  
  
  
</body>

</html>
