<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="zh-cn" lang="zh-cn" >

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.149.1">

  <title>Stanford 公开课 CS144 2025版 通关指南 &middot; What a Life!</title>

  <meta name="description" content="" />

  
  <meta itemprop="name" content="Stanford 公开课 CS144 2025版 通关指南">
  <meta itemprop="description" content="环境准备 我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：">
  <meta itemprop="datePublished" content="2025-07-15T09:43:31+08:00">
  <meta itemprop="dateModified" content="2025-07-15T09:43:31+08:00">
  <meta itemprop="wordCount" content="1104">
  <meta itemprop="image" content="https://www.zhangzewen.net/images/profile.png">
  <meta itemprop="keywords" content="公开课,Linux,Network">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.zhangzewen.net/images/profile.png">
  <meta name="twitter:title" content="Stanford 公开课 CS144 2025版 通关指南">
  <meta name="twitter:description" content="环境准备 我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：">


<meta property="og:url" content="https://www.zhangzewen.net/posts/linux/cs144_simple_summary/">
  <meta property="og:site_name" content="What a Life!">
  <meta property="og:title" content="Stanford 公开课 CS144 2025版 通关指南">
  <meta property="og:description" content="环境准备 我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-15T09:43:31+08:00">
    <meta property="article:modified_time" content="2025-07-15T09:43:31+08:00">
    <meta property="article:tag" content="公开课">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Network">
    <meta property="og:image" content="https://www.zhangzewen.net/images/profile.png">



<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type":"Person",
      "@id": "https://www.zhangzewen.net/#author",
      "name": "Zhang Zewen",
      "image": {
        "@type":"ImageObject",
        
        "url": "https://www.zhangzewen.net/images/android-chrome-512x512.png"
        
      },
      "description": "Software Engineer"
    },
    {
      "@type": "WebSite",
      "@id": "https://www.zhangzewen.net/#website",
      "url": "https://www.zhangzewen.net/",
      "name": "What a Life!",
      "description": "Software Engineer",
      "publisher": {
        "@id": "https://www.zhangzewen.net/#author"
      },
      "inLanguage": "zh-cn"
    },
    {
      "@type": "ImageObject",
      "url": "https://www.zhangzewen.net/images/profile.png",
      "caption": "What a Life!"
    },
    {
      "@type": "WebPage",
      "@id": "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/#webpage",
      "url": "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/",
      "name": "Stanford 公开课 CS144 2025版 通关指南",
      "isPartOf": {
        "@id": "https://www.zhangzewen.net/#website"
      },
      "about": {
         "@id": "https://www.zhangzewen.net/#author"
      },
      "datePublished": "2025-07-15T09:43:31+08:00",
      "dateModified": "2025-07-15T09:43:31+08:00",
      "description": "\u003ch2 id=\"环境准备\"\u003e环境准备\u003c/h2\u003e\n\u003cp\u003e我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：\u003c/p\u003e",
      "inLanguage": "zh-cn",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": [
            "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/"
          ]
        }
      ]
    },
    {
      "@type": "Article",
      "isPartOf": {
        "@id": "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/#webpage"
      },
      "mainEntityOfPage": {
        "@id": "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/#webpage"
      },
      "headline": "Stanford 公开课 CS144 2025版 通关指南",
      "datePublished": "2025-07-15T09:43:31+08:00",
      "dateModified": "2025-07-15T09:43:31+08:00",
      "publisher": {
        "@id": "https://www.zhangzewen.net/#author"
      },
      "keywords": [
        "公开课",
        "Linux",
        "Network"
      ],
      "articleSection": [
      ],
      "inLanguage": "zh-cn",
      "author": {
        "@type": "Person",
        "name":  null 
      },
      "potentialAction": [
        {
          "@type": "CommentAction",
          "name": "Comment",
          "target": [
            "https://www.zhangzewen.net/posts/linux/cs144_simple_summary/#comments"
          ]
        }
      ]
    }
  ]
}
</script>



  <link type="text/css" rel="stylesheet" href="/css/print.css" media="print">

  <link type="text/css" rel="stylesheet" href="/css/poole.css">

  <link type="text/css" rel="stylesheet" href="/css/hyde.css">

  


  

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>

<body>
  <aside class="toc">
  
  
  <h3>目录</h3>
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#环境准备">环境准备</a></li>
        <li><a href="#check0">check0</a></li>
        <li><a href="#check1">check1</a></li>
        <li><a href="#check23">check2&amp;3</a></li>
        <li><a href="#check56">check5&amp;6</a></li>
        <li><a href="#check47">check4&amp;7</a></li>
      </ul>
    </li>
  </ul>
</nav>
  
  
</aside>

  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="https://www.zhangzewen.net/">
            <img src="/images/android-chrome-512x512.png" class="img-circle img-headshot center" alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>What a Life!</h1>

      
      <p class="lead">Software Engineer</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://www.zhangzewen.net/">Home</a>
        </li>
        <li>
          <a href="/tags/">Tags</a>
        </li><li>
          <a href="/archive/">Archives</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
    </section>
  </div>
</aside>


  <main class="content container">
    <div class="post">
  <h1 class="title">Stanford 公开课 CS144 2025版 通关指南</h1>
  
  

  <div class="post-date">
    <time datetime=" 2025-07-15T09:43:31&#43;0800">Created: Jul 15, 2025</time>
    <span class="readtime">&middot; 6 min read</span>
  </div>

  <div>
    <h2 id="环境准备">环境准备</h2>
<p>我的机器是 2020 年的 intel mbp， 该项目在 mac 下是跑不通的，需要安装虚拟机，这里提供一个 lima 的虚拟机配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#928374;font-style:italic"># cs144.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#fb4934">images</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#fb4934">location</span>: <span style="color:#b8bb26">&#34;https://cloud-images.ubuntu.com/releases/oracular/release-20250701/ubuntu-24.10-server-cloudimg-amd64.img&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fb4934">arch</span>: <span style="color:#b8bb26">&#34;x86_64&#34;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#fb4934">location</span>: <span style="color:#b8bb26">&#34;https://cloud-images.ubuntu.com/releases/oracular/release-20250701/ubuntu-24.10-server-cloudimg-arm64.img&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fb4934">arch</span>: <span style="color:#b8bb26">&#34;aarch64&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fb4934">cpus</span>: <span style="color:#d3869b">4</span>
</span></span><span style="display:flex;"><span><span style="color:#fb4934">memory</span>: <span style="color:#b8bb26">&#34;10GiB&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fb4934">mounts</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#fb4934">location</span>: <span style="color:#b8bb26">&#34;~&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fb4934">writable</span>: <span style="color:#fe8019">true</span>
</span></span><span style="display:flex;"><span>- <span style="color:#fb4934">location</span>: <span style="color:#b8bb26">&#34;/tmp/lima&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fb4934">writable</span>: <span style="color:#fe8019">true</span>
</span></span><span style="display:flex;"><span><span style="color:#fb4934">provision</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#fb4934">mode</span>: system
</span></span><span style="display:flex;"><span>  <span style="color:#fb4934">script</span>: |<span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get update
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get install -y apt-transport-https ca-certificates curl clang llvm jq cmake nvim
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get install -y libelf-dev libpcap-dev libbfd-dev binutils-dev build-essential make
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get install -y linux-tools-common linux-tools-$(uname -r)
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get install -y bpfcc-tools
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26">    apt-get install -y python3-pip</span>
</span></span></code></pre></div><p>把该文件放置在 cs144 的源码目录下， 执行 <code>limactl start cs144</code> 等待其完成，然后执行 <code>limactl shell cs144</code> 即可进入到虚拟机环境，就可以愉快的写代码和编译了。使用 <code>limactl stop cs144</code> 即可关闭虚拟机。更多 lima 的使用方法请参考官方文档。如果是我这样的配置机器，首次编译工程的时候，机器可能直接卡住不动，不要担心，双手离开键盘等风扇不咋咋呼呼的时候就 OK 了。</p>
<p>如下是我的通关结算：</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>➜  cs144 git:<span style="color:#fe8019">(</span>main<span style="color:#fe8019">)</span> ✗ cmake --build build --target check3
</span></span><span style="display:flex;"><span>Test project /path/to/cs144/build
</span></span><span style="display:flex;"><span>      Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span> 1/37 Test  <span style="color:#928374;font-style:italic">#1: compile with bug-checkers ........   Passed   82.41 sec</span>
</span></span><span style="display:flex;"><span>      Start  3: byte_stream_basics
</span></span><span style="display:flex;"><span> 2/37 Test  <span style="color:#928374;font-style:italic">#3: byte_stream_basics ...............   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start  4: byte_stream_capacity
</span></span><span style="display:flex;"><span> 3/37 Test  <span style="color:#928374;font-style:italic">#4: byte_stream_capacity .............   Passed    0.03 sec</span>
</span></span><span style="display:flex;"><span>      Start  5: byte_stream_one_write
</span></span><span style="display:flex;"><span> 4/37 Test  <span style="color:#928374;font-style:italic">#5: byte_stream_one_write ............   Passed    0.03 sec</span>
</span></span><span style="display:flex;"><span>      Start  6: byte_stream_two_writes
</span></span><span style="display:flex;"><span> 5/37 Test  <span style="color:#928374;font-style:italic">#6: byte_stream_two_writes ...........   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start  7: byte_stream_many_writes
</span></span><span style="display:flex;"><span> 6/37 Test  <span style="color:#928374;font-style:italic">#7: byte_stream_many_writes ..........   Passed    0.12 sec</span>
</span></span><span style="display:flex;"><span>      Start  8: byte_stream_stress_test
</span></span><span style="display:flex;"><span> 7/37 Test  <span style="color:#928374;font-style:italic">#8: byte_stream_stress_test ..........   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start  9: reassembler_single
</span></span><span style="display:flex;"><span> 8/37 Test  <span style="color:#928374;font-style:italic">#9: reassembler_single ...............   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 10: reassembler_cap
</span></span><span style="display:flex;"><span> 9/37 Test <span style="color:#928374;font-style:italic">#10: reassembler_cap ..................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 11: reassembler_seq
</span></span><span style="display:flex;"><span>10/37 Test <span style="color:#928374;font-style:italic">#11: reassembler_seq ..................   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start 12: reassembler_dup
</span></span><span style="display:flex;"><span>11/37 Test <span style="color:#928374;font-style:italic">#12: reassembler_dup ..................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 13: reassembler_holes
</span></span><span style="display:flex;"><span>12/37 Test <span style="color:#928374;font-style:italic">#13: reassembler_holes ................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 14: reassembler_overlapping
</span></span><span style="display:flex;"><span>13/37 Test <span style="color:#928374;font-style:italic">#14: reassembler_overlapping ..........   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 15: reassembler_win
</span></span><span style="display:flex;"><span>14/37 Test <span style="color:#928374;font-style:italic">#15: reassembler_win ..................   Passed    0.35 sec</span>
</span></span><span style="display:flex;"><span>      Start 16: wrapping_integers_cmp
</span></span><span style="display:flex;"><span>15/37 Test <span style="color:#928374;font-style:italic">#16: wrapping_integers_cmp ............   Passed    0.03 sec</span>
</span></span><span style="display:flex;"><span>      Start 17: wrapping_integers_wrap
</span></span><span style="display:flex;"><span>16/37 Test <span style="color:#928374;font-style:italic">#17: wrapping_integers_wrap ...........   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>      Start 18: wrapping_integers_unwrap
</span></span><span style="display:flex;"><span>17/37 Test <span style="color:#928374;font-style:italic">#18: wrapping_integers_unwrap .........   Passed    0.02 sec</span>
</span></span><span style="display:flex;"><span>      Start 19: wrapping_integers_roundtrip
</span></span><span style="display:flex;"><span>18/37 Test <span style="color:#928374;font-style:italic">#19: wrapping_integers_roundtrip ......   Passed    0.37 sec</span>
</span></span><span style="display:flex;"><span>      Start 20: wrapping_integers_extra
</span></span><span style="display:flex;"><span>19/37 Test <span style="color:#928374;font-style:italic">#20: wrapping_integers_extra ..........   Passed    0.29 sec</span>
</span></span><span style="display:flex;"><span>      Start 21: recv_connect
</span></span><span style="display:flex;"><span>20/37 Test <span style="color:#928374;font-style:italic">#21: recv_connect .....................   Passed    0.03 sec</span>
</span></span><span style="display:flex;"><span>      Start 22: recv_transmit
</span></span><span style="display:flex;"><span>21/37 Test <span style="color:#928374;font-style:italic">#22: recv_transmit ....................   Passed    0.71 sec</span>
</span></span><span style="display:flex;"><span>      Start 23: recv_window
</span></span><span style="display:flex;"><span>22/37 Test <span style="color:#928374;font-style:italic">#23: recv_window ......................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 24: recv_reorder
</span></span><span style="display:flex;"><span>23/37 Test <span style="color:#928374;font-style:italic">#24: recv_reorder .....................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 25: recv_reorder_more
</span></span><span style="display:flex;"><span>24/37 Test <span style="color:#928374;font-style:italic">#25: recv_reorder_more ................   Passed    1.51 sec</span>
</span></span><span style="display:flex;"><span>      Start 26: recv_close
</span></span><span style="display:flex;"><span>25/37 Test <span style="color:#928374;font-style:italic">#26: recv_close .......................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 27: recv_special
</span></span><span style="display:flex;"><span>26/37 Test <span style="color:#928374;font-style:italic">#27: recv_special .....................   Passed    0.07 sec</span>
</span></span><span style="display:flex;"><span>      Start 28: send_connect
</span></span><span style="display:flex;"><span>27/37 Test <span style="color:#928374;font-style:italic">#28: send_connect .....................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 29: send_transmit
</span></span><span style="display:flex;"><span>28/37 Test <span style="color:#928374;font-style:italic">#29: send_transmit ....................   Passed    1.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 30: send_window
</span></span><span style="display:flex;"><span>29/37 Test <span style="color:#928374;font-style:italic">#30: send_window ......................   Passed    0.25 sec</span>
</span></span><span style="display:flex;"><span>      Start 31: send_ack
</span></span><span style="display:flex;"><span>30/37 Test <span style="color:#928374;font-style:italic">#31: send_ack .........................   Passed    0.04 sec</span>
</span></span><span style="display:flex;"><span>      Start 32: send_close
</span></span><span style="display:flex;"><span>31/37 Test <span style="color:#928374;font-style:italic">#32: send_close .......................   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start 33: send_retx
</span></span><span style="display:flex;"><span>32/37 Test <span style="color:#928374;font-style:italic">#33: send_retx ........................   Passed    0.05 sec</span>
</span></span><span style="display:flex;"><span>      Start 34: send_extra
</span></span><span style="display:flex;"><span>33/37 Test <span style="color:#928374;font-style:italic">#34: send_extra .......................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>      Start 37: no_skip
</span></span><span style="display:flex;"><span>34/37 Test <span style="color:#928374;font-style:italic">#37: no_skip ..........................   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>      Start 38: compile with optimization
</span></span><span style="display:flex;"><span>35/37 Test <span style="color:#928374;font-style:italic">#38: compile with optimization ........   Passed   14.46 sec</span>
</span></span><span style="display:flex;"><span>      Start 39: byte_stream_speed_test
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 4096<span style="color:#fe8019">)</span>: 14.21 Gbit/s
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 128<span style="color:#fe8019">)</span>:  12.19 Gbit/s
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 32<span style="color:#fe8019">)</span>:    7.66 Gbit/s
</span></span><span style="display:flex;"><span>36/37 Test <span style="color:#928374;font-style:italic">#39: byte_stream_speed_test ...........   Passed    0.29 sec</span>
</span></span><span style="display:flex;"><span>      Start 40: reassembler_speed_test
</span></span><span style="display:flex;"><span>        Reassembler throughput <span style="color:#fe8019">(</span>no overlap<span style="color:#fe8019">)</span>:  69.06 Gbit/s
</span></span><span style="display:flex;"><span>        Reassembler throughput <span style="color:#fe8019">(</span>10x overlap<span style="color:#fe8019">)</span>:  9.97 Gbit/s
</span></span><span style="display:flex;"><span>37/37 Test <span style="color:#928374;font-style:italic">#40: reassembler_speed_test ...........   Passed    0.29 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#d3869b">0</span> tests failed out of <span style="color:#d3869b">37</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#fabd2f">time</span> <span style="color:#fe8019">(</span>real<span style="color:#fe8019">)</span> <span style="color:#fe8019">=</span> 103.50 sec
</span></span><span style="display:flex;"><span>Built target check3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>➜  cs144 git:<span style="color:#fe8019">(</span>main<span style="color:#fe8019">)</span> ✗ cmake --build build --target check6
</span></span><span style="display:flex;"><span>Test project /path/to/cs144/build
</span></span><span style="display:flex;"><span>    Start  1: compile with bug-checkers
</span></span><span style="display:flex;"><span>1/4 Test  <span style="color:#928374;font-style:italic">#1: compile with bug-checkers ........   Passed   17.50 sec</span>
</span></span><span style="display:flex;"><span>    Start 35: net_interface
</span></span><span style="display:flex;"><span>2/4 Test <span style="color:#928374;font-style:italic">#35: net_interface ....................   Passed    0.10 sec</span>
</span></span><span style="display:flex;"><span>    Start 36: router
</span></span><span style="display:flex;"><span>3/4 Test <span style="color:#928374;font-style:italic">#36: router ...........................   Passed    0.09 sec</span>
</span></span><span style="display:flex;"><span>    Start 37: no_skip
</span></span><span style="display:flex;"><span>4/4 Test <span style="color:#928374;font-style:italic">#37: no_skip ..........................   Passed    0.01 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#d3869b">0</span> tests failed out of <span style="color:#d3869b">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#fabd2f">time</span> <span style="color:#fe8019">(</span>real<span style="color:#fe8019">)</span> <span style="color:#fe8019">=</span>  17.75 sec
</span></span><span style="display:flex;"><span>Built target check6
</span></span></code></pre></div><p>我在自己的台式机上跑了下 speed：</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>➜  cmake --build build --target speed 
</span></span><span style="display:flex;"><span>Test project /path/to/cs144/build
</span></span><span style="display:flex;"><span>Connected to MAKE jobserver
</span></span><span style="display:flex;"><span>    Start 38: compile with optimization
</span></span><span style="display:flex;"><span>1/3 Test <span style="color:#928374;font-style:italic">#38: compile with optimization ........   Passed    1.97 sec</span>
</span></span><span style="display:flex;"><span>    Start 39: byte_stream_speed_test
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 4096<span style="color:#fe8019">)</span>: 20.25 Gbit/s
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 128<span style="color:#fe8019">)</span>:  14.91 Gbit/s
</span></span><span style="display:flex;"><span>        ByteStream throughput <span style="color:#fe8019">(</span>pop length 32<span style="color:#fe8019">)</span>:    8.95 Gbit/s
</span></span><span style="display:flex;"><span>2/3 Test <span style="color:#928374;font-style:italic">#39: byte_stream_speed_test ...........   Passed    0.44 sec</span>
</span></span><span style="display:flex;"><span>    Start 40: reassembler_speed_test
</span></span><span style="display:flex;"><span>        Reassembler throughput <span style="color:#fe8019">(</span>no overlap<span style="color:#fe8019">)</span>:  126.71 Gbit/s
</span></span><span style="display:flex;"><span>        Reassembler throughput <span style="color:#fe8019">(</span>10x overlap<span style="color:#fe8019">)</span>: 14.98 Gbit/s
</span></span><span style="display:flex;"><span>3/3 Test <span style="color:#928374;font-style:italic">#40: reassembler_speed_test ...........   Passed    0.19 sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100% tests passed, <span style="color:#d3869b">0</span> tests failed out of <span style="color:#d3869b">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total Test <span style="color:#fabd2f">time</span> <span style="color:#fe8019">(</span>real<span style="color:#fe8019">)</span> <span style="color:#fe8019">=</span>   2.60 sec
</span></span><span style="display:flex;"><span>Built target speed
</span></span></code></pre></div><blockquote>
<p>注意： 在实现的时候，请一定要先看test case， 搞清楚接口的功能和边界条件后再敲代码。这个项目难度不大，项目的精华是整体的框架和细致的单元测试，强烈建议在完成各个 check 之后读下框架代码。</p></blockquote>
<h2 id="check0">check0</h2>
<p>check0 作为热身还是挺简单的，熟悉项目代码做的引子，没有啥说的必要。</p>
<h2 id="check1">check1</h2>
<p>check1 的 <code>ByteStream</code> 使用读写双游标追赶来实现环形缓冲区即可。<code>Reassembler</code> 在 <code>ByteStream</code> 的基础上维护一个 <strong>子字符串</strong> 的起始/终止(左闭右开区间)下标的集合 <code>std::vector</code>，每次写数据后（需要注意到底要写多少数据），遍历一遍 <code>std::vector</code>（考虑到<strong>子字符串</strong>多的话，这个地方是可以优化的点），合并/新增区间，然后更新相应的游标即可。</p>
<h2 id="check23">check2&amp;3</h2>
<p>在 check1 的基础上实现一个简化版且能用的 tcp 协议。</p>
<p><code>wrapping_integers</code> 这个没啥好说的，画画图就清楚了。请看如下图示：</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>          seqno   <span style="color:#d3869b">3</span>           <span style="color:#d3869b">0</span>             <span style="color:#d3869b">1</span>          <span style="color:#d3869b">2</span>
</span></span><span style="display:flex;"><span> ----------------------------------------------------------
</span></span><span style="display:flex;"><span> absolute seqno   <span style="color:#d3869b">0</span>           <span style="color:#d3869b">1</span>             <span style="color:#d3869b">2</span>          <span style="color:#d3869b">3</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d3869b">4</span>           <span style="color:#d3869b">5</span>             <span style="color:#d3869b">6</span>          <span style="color:#d3869b">7</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d3869b">8</span>           <span style="color:#d3869b">9</span>             <span style="color:#d3869b">10</span>         <span style="color:#d3869b">11</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d3869b">12</span>          <span style="color:#d3869b">13</span>            <span style="color:#d3869b">14</span>         <span style="color:#d3869b">15</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d3869b">16</span>          <span style="color:#d3869b">17</span>            <span style="color:#d3869b">18</span>         <span style="color:#d3869b">19</span>
</span></span></code></pre></div><p>至于 <code>tcp_receiver</code> 和 <code>tcp_sender</code> 的实现，建议使用有限状态机来实现，写起来也比较顺畅，因为是简化版，所以边界条件不怎么复杂。你需要知道 sender 和 receiver 都有那些状态。可以参考下图的状态转移（图来自 RFC 9293）：</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>                            +---------+ ---------<span style="color:#b8bb26">\ </span>     active OPEN
</span></span><span style="display:flex;"><span>                            |  CLOSED |            <span style="color:#b8bb26">\ </span>   -----------
</span></span><span style="display:flex;"><span>                            +---------+&lt;---------<span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\ </span>  create TCB
</span></span><span style="display:flex;"><span>                              |     ^              <span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\ </span> snd SYN
</span></span><span style="display:flex;"><span>                 passive OPEN |     |   CLOSE        <span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>                 ------------ |     | ----------       <span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>                  create TCB  |     | delete TCB         <span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>                              V     |                      <span style="color:#b8bb26">\ </span>  <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>          rcv RST <span style="color:#fe8019">(</span>note 1<span style="color:#fe8019">)</span>  +---------+            CLOSE    |    <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>       --------------------&gt;|  LISTEN |          ---------- |     |
</span></span><span style="display:flex;"><span>      /                     +---------+          delete TCB |     |
</span></span><span style="display:flex;"><span>     /           rcv SYN      |     |     SEND              |     |
</span></span><span style="display:flex;"><span>    /           -----------   |     |    -------            |     V
</span></span><span style="display:flex;"><span>+--------+      snd SYN,ACK  /       <span style="color:#b8bb26">\ </span>  snd SYN          +--------+
</span></span><span style="display:flex;"><span>|        |&lt;-----------------           ------------------&gt;|        |
</span></span><span style="display:flex;"><span>|  SYN   |                    rcv SYN                     |  SYN   |
</span></span><span style="display:flex;"><span>|  RCVD  |&lt;-----------------------------------------------|  SENT  |
</span></span><span style="display:flex;"><span>|        |                  snd SYN,ACK                   |        |
</span></span><span style="display:flex;"><span>|        |------------------           -------------------|        |
</span></span><span style="display:flex;"><span>+--------+   rcv ACK of SYN  <span style="color:#b8bb26">\ </span>      /  rcv SYN,ACK       +--------+
</span></span><span style="display:flex;"><span>   |         --------------   |     |   -----------
</span></span><span style="display:flex;"><span>   |                x         |     |     snd ACK
</span></span><span style="display:flex;"><span>   |                          V     V
</span></span><span style="display:flex;"><span>   |  CLOSE                 +---------+
</span></span><span style="display:flex;"><span>   | -------                |  ESTAB  |
</span></span><span style="display:flex;"><span>   | snd FIN                +---------+
</span></span><span style="display:flex;"><span>   |                 CLOSE    |     |    rcv FIN
</span></span><span style="display:flex;"><span>   V                -------   |     |    -------
</span></span><span style="display:flex;"><span>+---------+         snd FIN  /       <span style="color:#b8bb26">\ </span>  snd ACK         +---------+
</span></span><span style="display:flex;"><span>|  FIN    |&lt;----------------          ------------------&gt;|  CLOSE  |
</span></span><span style="display:flex;"><span>| WAIT-1  |------------------                            |   WAIT  |
</span></span><span style="display:flex;"><span>+---------+          rcv FIN  <span style="color:#b8bb26">\ </span>                         +---------+
</span></span><span style="display:flex;"><span>  | rcv ACK of FIN   -------   |                          CLOSE  |
</span></span><span style="display:flex;"><span>  | --------------   snd ACK   |                         ------- |
</span></span><span style="display:flex;"><span>  V        x                   V                         snd FIN V
</span></span><span style="display:flex;"><span>+---------+               +---------+                    +---------+
</span></span><span style="display:flex;"><span>|FINWAIT-2|               | CLOSING |                    | LAST-ACK|
</span></span><span style="display:flex;"><span>+---------+               +---------+                    +---------+
</span></span><span style="display:flex;"><span>  |              rcv ACK of FIN |                 rcv ACK of FIN |
</span></span><span style="display:flex;"><span>  |  rcv FIN     -------------- |    Timeout<span style="color:#fe8019">=</span>2MSL -------------- |
</span></span><span style="display:flex;"><span>  |  -------            x       V    ------------        x       V
</span></span><span style="display:flex;"><span>   <span style="color:#b8bb26">\ </span>snd ACK              +---------+delete TCB          +---------+
</span></span><span style="display:flex;"><span>     --------------------&gt;|TIME-WAIT|-------------------&gt;| CLOSED  |
</span></span><span style="display:flex;"><span>                          +---------+                    +---------+
</span></span></code></pre></div><h2 id="check56">check5&amp;6</h2>
<p>check5 和 check6 这两个的实现比较简单，check5 需要知道 arp 记录缓存的过期时间 和 waiting 中的记录的超时时间的计算在 <code>NetworkInterface::tick</code> 中实现，check6 需要知道路由表的一些知识，剩下就是把文档描述翻译成代码即可实现。</p>
<h2 id="check47">check4&amp;7</h2>

  </div>


  
<div>
  <ul class="tags">
  <li>
    <a href="https://www.zhangzewen.net/tags/%E5%85%AC%E5%BC%80%E8%AF%BE/" class="tag-link">公开课</a>
  </li>
  
  <li>
    <a href="https://www.zhangzewen.net/tags/linux/" class="tag-link">Linux</a>
  </li>
  
  <li>
    <a href="https://www.zhangzewen.net/tags/network/" class="tag-link">Network</a>
  </li>
  </ul>
</div>



  <div class="share-buttons">
    
  
<script src="https://utteranc.es/client.js"
        repo="zhangzewen/zhangzewen.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</div>


  
</div>
  </main>

  <footer>
  <div>
    <p>
      &copy; Zhang Zewen 2025

      &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

      
    </p>
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
    integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin="anonymous"></script>


  <script src="/js/jquery.min.js"></script>
  <script src="/js/soho.js"></script>

  

  
  
  
</body>

</html>
